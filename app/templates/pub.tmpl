{% extends "base.tmpl" %}

{% macro entity_group(name, entities) %}
    <div class="entity_group">
        <h2>{{ name }}</h2>
        {% if not entities %}
            None
        {% else %}
            <div class="entities">
                {% for e in entities.itervalues() %}
                    {{ entity(e) }}
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro entity(ent) %}
    <div class="entity">
        {% set (score, max_score) = ent.score() %}
        <div class="ent_id">{{ ent.id }} ({{ score }}/{{ max_score }})</div>
        {% for error in ent.errors %}
            <div class="error">{{ error.render() }}</div>
        {% endfor %}
        <ul class="fields">
            {% for field in ent.fields.itervalues() %}
                <li>{{ field.display_name }}: {{ field.render_value() }} </li>
            {% endfor %}
        </ul>
        <div class="points">
            Points
            {% for (value, note) in ent.points %}
                <br/>
                {{ value }} {{ note }}
            {% endfor %}
        </div>
        <div class="annot_links">
            Annotations
            {% for annot_link in ent.annotation_links() %}
                <br/>
                {{ annot_link }}
            {% endfor %}
        </div>
    </div>
{% endmacro %}

{% block title %}PMC {{ pub.pmc_id }} - CANDI Share Publication Portal{% endblock %}

{% block body %}

<div id="pub_link">
PMC ID <a href="http://via.hypothes.is/http://www.ncbi.nlm.nih.gov/pmc/articles/{{ pub.pmc_id }}">{{ pub.pmc_id }}</a>.
</div>

<div id="summary">
    {% if pub.errors %}
        <h2>Errors</h2>
        {% for error in pub.errors %}
            <p>{{ error.render() }}</p>
        {% endfor %}
    {% endif %}
    {% set (score, max_score) = pub.score() %}
    Score: {{ score }}/{{ max_score }}
</div>

{{ entity_group('Subject Groups', pub.entities['SubjectGroup']) }}

{{ entity_group('Acquisition Instruments', pub.entities['AcquisitionInstrument']) }}

{{ entity_group('Acquisitions', pub.entities['Acquisitions']) }}

{{ entity_group('Data', pub.entities['Data']) }}

{{ entity_group('Analysis Workflows', pub.entities['AnalysisWorkflow']) }}

{{ entity_group('Observations', pub.entities['Observation']) }}

{{ entity_group('Models', pub.entities['Model']) }}

{{ entity_group('Model Applications', pub.entities['ModelApplication']) }}

{{ entity_group('Results', pub.entities['Result']) }}

{% endblock %}
