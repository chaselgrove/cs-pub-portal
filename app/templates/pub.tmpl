{% extends "base.tmpl" %}

{% macro entity_group(name, entities) %}
    <div class="entity_group">
        <h2>{{ name }}</h2>
        {% if not entities %}
            None
        {% else %}
            <div class="entities">
                {% for en in entities|sort %}
                    {{ entity(entities[en]) }}
                {% endfor %}
                <div class="clear">&nbsp;</div>
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro entity(ent) %}
    <div class="entity">
        <div class="header">
            {% set (score, max_score) = ent.score() %}
            <div class="id">{{ ent.id }}</div>
            <div class="score">{{ score }}/{{ max_score }}</div>
        </div>
        <div class="clear">&nbsp;</div>
         {% for error in ent.errors %}
             <div class="error">{{ error.render() }}</div>
         {% endfor %}
        <ul class="fields">
            {% for field in ent.fields.itervalues() %}
                <li>{{ field.display_name }}: {{ field.render_value() }}</li>
            {% endfor %}
        </ul>
        <div class="annot_links">
            Defined in:
            <ul>
            {% for annot_link in ent.annotation_links() %}
                <li>{{ annot_link }}</li>
            {% endfor %}
            </ul>
        </div>
        <ul class="points">
        {% for (value, note) in ent.points %}
            {% if value > 0 %}
                <li><span class="value">+{{ value }}</span> <span class="note">{{ note }}</span></li>
            {% else %}
                <li><span class="value">{{ value }}</span> <span class="note">{{ note }}</span></li>
            {% endif %}
        {% endfor %}
        </ul>
        <div class="clear">&nbsp;</div>
        {% if ent.links %}
            <div class="pub_links">
                Find other studies:
                <ul>
                    {% for (text, url) in ent.links %}
                        <li><a href="{{ url }}">{{ text }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% block title %}PMID {{ pub.pmid }} - CANDI Share Publication Portal{% endblock %}

{% block body %}

{% if error %}
    <p><span class="error">{{ error }}</span></p>
{% else %}

    <div id="summary">
        <p>CANDI Share publication portal report for "{{ pub.title }}".</p>

        <p>PubMed ID <a href="https://www.ncbi.nlm.nih.gov/pubmed/{{ pub.pmid }}">{{ pub.pmid }}</a></p>

        <p>Markup via PubMed Central (<a href="http://via.hypothes.is/http://www.ncbi.nlm.nih.gov/pmc/articles/{{ pub.pmc_id }}">{{ pub.pmc_id }}</a>).</p>

        {% if pub.errors %}
            <h2>Errors</h2>
            {% for error in pub.errors %}
                <p>{{ error.render() }}</p>
            {% endfor %}
        {% endif %}

        {% set (score, max_score) = pub.score() %}
        <p>Score: {{ score }}/{{ max_score }}</p>

    </div>

    {{ entity_group('Subject Groups', pub.entities['SubjectGroup']) }}

    {{ entity_group('Acquisition Instruments', pub.entities['AcquisitionInstrument']) }}

    {{ entity_group('Acquisitions', pub.entities['Acquisition']) }}

    {{ entity_group('Data', pub.entities['Data']) }}

    {{ entity_group('Analysis Workflows', pub.entities['AnalysisWorkflow']) }}

    {{ entity_group('Observations', pub.entities['Observation']) }}

    {{ entity_group('Models', pub.entities['Model']) }}

    {{ entity_group('Model Applications', pub.entities['ModelApplication']) }}

    {{ entity_group('Results', pub.entities['Result']) }}

{% endif %}

{% endblock %}
